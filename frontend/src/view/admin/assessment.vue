<template>
  <v-container>
    <h2 class="text-h5 mb-4">‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô</h2>

    <!-- üîµ ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• -->
    <v-card class="pa-4 mb-4">
      <v-row >
        <v-col cols="12" md="6">
             <h6 class="text-h6">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô</h6>
          <v-text-field
           label="‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô"
            v-model="form.topic"
            variant="outlined"
          />
        </v-col>

        <v-col cols="12" md="6">
            <h6 class="text-h6">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏¢‡πà‡∏≠‡∏¢</h6>
          <v-text-field
            v-model="form.subtopic"
            label="‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏¢‡πà‡∏≠‡∏¢"
            variant="outlined"
          />
        </v-col>

        <v-col cols="12" md="6">
            <h6 class="text-h6">‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô</h6>
          <v-text-field
            v-model="form.description"
            label="‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô"
            variant="outlined"
          />
        </v-col>

        <v-col cols="12" md="6">
            <h6 class="text-h6">‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏¢‡πà‡∏≠‡∏¢</h6>
          <v-text-field
            v-model="form.subdescription"
            label="‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏¢‡πà‡∏≠‡∏¢"
            variant="outlined"
          />
        </v-col>
        <v-col cols="12" md="6">
            <h6 class="text-h6">‡∏£‡∏π‡∏õ‡πÄ‡πÄ‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô</h6>
        <v-select v-model="formselect" :items="items"  variant="outlined">
          <template v-slot:item="{ props, item }">
            <v-list-item v-bind="props" :title="null">
              <v-list-item-title>{{ item.title }}</v-list-item-title>
            </v-list-item>
          </template>
        </v-select>
             </v-col>
        <v-col cols="12" md="6">
            <h6 class="text-h6">‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏Ñ‡∏∞‡πÄ‡πÄ‡∏ô‡∏ô(%)</h6>
          <v-text-field
            v-model="form.subdescription"
            label="‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏Ñ‡∏∞‡πÄ‡πÄ‡∏ô‡∏ô(%)"
            variant="outlined"
          />
        </v-col>
      </v-row>

      <v-btn color="primary" class="mt-4" @click="addToTable">
        ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
      </v-btn>
    </v-card>

    <!-- üü¢ ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å -->
    <v-card class="pa-4">
      <v-data-table
        :headers="headers"
        :items="savedData"
        class="elevation-1"
      >
        <template #item.actions="{ index }">
          <v-btn color="red" variant="text" @click="removeRow(index)">
            ‡∏•‡∏ö
          </v-btn>
        </template>
      </v-data-table>

      <v-btn
        color="primary"
        class="mt-4"
        :disabled="savedData.length === 0"
        @click="sendToBackend"
      >
        ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
      </v-btn>
    </v-card>
  </v-container>
</template>

<script setup>
import { reactive, ref } from "vue";
import axios from "axios";

// ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
const form = reactive({
  topic: "",
  description: "",
  subtopic: "",
  subdescription: "",
});

// ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß
const savedData = ref([]);

// ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏Ç‡∏≠‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á
const headers = [
  { title: "‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô", key: "topic" },
  { title: "‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢", key: "description" },
  { title: "‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏¢‡πà‡∏≠‡∏¢", key: "subtopic" },
  { title: "‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏¢‡πà‡∏≠‡∏¢", key: "subdescription" },
  { title: "‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£", key: "actions", align: "center" },
];

// ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á
function addToTable() {
  if (!form.topic || !form.subtopic) {
    alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö");
    return;
  }

  savedData.value.push({
    topic: form.topic,
    description: form.description,
    subtopic: form.subtopic,
    subdescription: form.subdescription,
  });

  // reset ‡∏ü‡∏≠‡∏£‡πå‡∏°
  form.topic = "";
  form.description = "";
  form.subtopic = "";
  form.subdescription = "";
}

// ‚ùå ‡∏•‡∏ö‡πÅ‡∏ñ‡∏ß
function removeRow(index) {
  savedData.value.splice(index, 1);
}

// üü¢ ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÑ‡∏õ backend
async function sendToBackend() {
  try {
    const response = await axios.post(
      "http://localhost:7000/api/assessment/part5",
      savedData.value
    );

    console.log("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:", response.data);
    alert("‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");

    // ‡∏´‡∏•‡∏±‡∏á‡∏™‡πà‡∏á ‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á
    savedData.value = [];

  } catch (error) {
    console.error(error);
    alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•");
  }
}
</script>

<style scoped>
</style>
